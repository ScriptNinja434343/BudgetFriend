<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bargain</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Protest+Strike&family=Qwitcher+Grypen:wght@400;700&display=swap" rel="stylesheet">    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DynaPuff:wght@400..700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css?family=Catamaran:800|Montserrat|Open+Sans:400,800&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            padding-top: 60px; /* Add padding to avoid overlap with the fixed header */
            background-color: #f7f7f7;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid #eaeaea;
            position: fixed; /* Set the header to fixed position */
            top: 0; /* Stick to the top */
            left: 0; /* Align with the left */
            right: 0; /* Align with the right */
            background: #eb86ff;; /* Background color for visibility */
            z-index: 1000; /* Ensure it is above other elements */
            border-radius: 0 0 10px 10px; /* Round the bottom corners */
        }
        .header .logo {
            font-family: "Bebas Neue", serif;
            font-size: 28px;
            font-weight: bold;
            color:#ffffff ;
            font-weight: 100;
            margin-left: -8px;
        }
        .header .right-icons {
            display: flex;
            gap: 15px;
        }
        .header .right-icons i {
            font-size: 18px;
        }
        .sub-header {
            text-align: center;
            padding: 10px 0;
            font-size: 14px;
            font-weight: 600;
            color:  #7c0176;

        }
        .main-content {
            text-align: center;
            padding: 40px 20px;
        }
        .main-content h3 {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            margin: 0;
        }
        .search-container {
            display: flex; /* Use flexbox to align the input and its container */
            justify-content: center; /* Center the input horizontally */
            margin: 0 20px; /* Add margin to the left and right of the container */
        }
        
        .search-container input {
            padding: 10px;
            width: 200px; /* Default width */
            border: 1px solid #ffffff9a;
            border-radius: 10px;
            background-color: #f1bffa63;
            margin: 0 20px; /* Equal gap on the left and right */
            color: white;
            font-size: 15px;
            font-weight: 1000;
            transition: width 0.3s ease; /* Smooth transition for width changes */
        }
        
        /* Adjust the input width for larger screens */
        @media screen and (min-width: 768px) {
            .search-container input {
                width: 240px; /* Wider width for larger screens */
            }
        }
        
        /* Adjust the input width for medium-sized screens */
        @media screen and (max-width: 768px) and (min-width: 480px) {
            .search-container input {
                width: 180px; /* Decrease width for medium screens */
            }
        }
        
        /* Adjust the input width for smaller screens */
        @media screen and (max-width: 480px) {
            .search-container input {
                width: 150px; /* Further decrease width for small screens */
                font-size: 14px; /* Optionally decrease font size */
            }
        }
        
        .product-list {
            background-color: #a600c700;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .product-item {
            text-align: center;
            border: 1px solid #ffffff;
            padding: 20px;
            border-radius: 20px;
            background:  #ffffff;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
        }
        .product-item img {
            width: 100%;
            height: 150px;
            object-fit: contain;
            border-radius: 8px;
        }
        .product-item h2 {
            font-family: "Quicksand", sans-serif;
                font-size: 12px;
            margin: 10px 0 5px;
        }
        .product-item p {
            margin: 5px 0;
            color: #888;
        }
        .product-item .price {
            font-weight: bold;
            color: #000000; /* Highlight color for the price */
            font-size: 20px; /* Increased font size for emphasis */
        }
        .stars {
            font-size: 12px;
            display: flex;
            justify-content: center;
            margin: 5px 0;
        }
        .stars i {
            color: #ffd700;
        }
        /* Add shimmer effect styles */
        .shimmer {
            background: linear-gradient(90deg, #e05ef4 25%, #e4aafd 50%, #f8c5fd 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }
        .shimmer-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        /* Media queries */
        @media (max-width: 768px) {
            .product-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        h3{
            color: #590176;
        }


        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
        }
        .toast {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            z-index: 1000;
        }
        .close-btn {
            cursor: pointer;
            background-color: red;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .button {
            background-color: rgba(255, 255, 255, 0.568);
            position: absolute;
            top: 10;
            right: 8px;
            background-color: none;
            border: 0;
            border-radius: 10px;
            font-size: 20px;
            padding: 9px 10px;
            color: #9b01b6;
            font-weight: bold;
            letter-spacing: 1px;
            cursor: pointer;
            transition: letter-spacing 0.5s;
        }

        .button:hover {
            letter-spacing: 2px;
        }

     /* Floating Button Styles */
.float-button {
    position: fixed;
    bottom: 20px; /* Position from the bottom */
    right: 20px; /* Position from the right */
    background-color: #9b01b6; /* Background color */
    color: white; /* Text color */
    border: none; /* No border */
    border-radius: 50%; /* Circular shape */
    width: 60px; /* Width */
    height: 60px; /* Height */
    display: flex; /* Flexbox */
    justify-content: center; /* Center the icon */
    align-items: center; /* Center the icon */
    font-size: 24px; /* Icon size */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Shadow */
    transition: background-color 0.3s; /* Transition effect */
    text-decoration: none;
}

.float-button:hover {
    background-color: #a60c7a; /* Darker on hover */
}

/* Modal Styles */
.modal {
    display: absolute; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 30%;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(249, 5, 5, 0); /* Black w/ opacity */
}

.modal-content {
    backdrop-filter: blur(10px);
color: rgb(173, 1, 167);
    display: absolute; 
    top: 40%;
    background-color: #faf7fb; /* White background */
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px; /* Padding */
    border: 1px solid #888; /* Border */
    width: 80%; /* Width of modal */
    max-width: 500px; /* Maximum width */
    border-radius: 10px; /* Rounded corners */
}

.close-button {
    color: #aaa; /* Close button color */
    float: right; /* Float to the right */
    font-size: 28px; /* Font size */
    font-weight: bold; /* Font weight */
}

.close-button:hover,
.close-button:focus {
    color: black; /* Change color on hover */
    text-decoration: none; /* No underline */
    cursor: pointer; /* Pointer cursor */
}



/* Change placeholder color */
.search-container input::placeholder {
    color: #ffffff; /* Set your desired placeholder color */
    opacity: 0.7; /* Optional: adjust the opacity for a faded effect */
}

/* You can also set styles for different input sizes */
@media screen and (max-width: 768px) {
    .search-container input::placeholder {
        color: #ffffff; /* Same or different color for smaller screens */
    }
}

.share-btn{
    background-color: #9b01b6;
  margin-top: 5px;
    background-color: none;
    border: 0;
    border-radius: 10px;
    font-size: 12px;
    padding: 9px 10px;
    color: #fff;
    font-weight: bold;
    letter-spacing: 1px;
   
}

.share-btn:hover{
    background-color: #710084;
}


#welcome-message{
    color:  #9b01b6;

    font-size: 20px;
    margin-top: 30px;
    text-align: center;
}

.user-name{
    font-family: "DynaPuff", system-ui;
    color:  #9b01b6;
    font-weight: 1000;
    
}


    </style>

  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";



    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC3WxZBaNJoZA2p7oe6ihTJCFOE6Y0U_7Q",
        authDomain: "dropshipping-98eb5.firebaseapp.com",
        projectId: "dropshipping-98eb5",
        storageBucket: "dropshipping-98eb5.appspot.com",
        messagingSenderId: "904925867242",
        appId: "1:904925867242:web:af0abda866826e92f8fb93",
        measurementId: "G-BVZR8HY1SR"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth(app);

    let productsData = []; // Store products data

    // Check authentication state
    onAuthStateChanged(auth, (user) => {
        if (!user) {
            // User is not logged in, redirect to login page
            window.location.href = '../login'; // Change to your login page URL
        } else {
            // User is logged in, fetch products
            try {
                fetchProducts();
            } catch (error) {
                console.error("Error fetching products: ", error);
            }
        }
    });

    // Fetch products from Firebase
    function fetchProducts() {
        const productsRef = ref(database, 'products');
        onValue(productsRef, (snapshot) => {
            const products = snapshot.val();
            productsData = products || []; // Fallback to an empty array if no products
            displayProducts(products);
        });
    }

    function displayProducts(products) {
        const productList = document.querySelector('.product-list');
        productList.innerHTML = ''; // Clear existing products
    
        // Check local storage once to avoid redundant calls inside the loop
        const sharedProducts = Object.keys(products).reduce((acc, key) => {
            const shareButtonState = localStorage.getItem(`shareButtonState-${key}`);
            acc[key] = shareButtonState === 'shared'; // true if shared
            return acc;
        }, {});
    
        for (const key in products) {
            if (products.hasOwnProperty(key)) {
                const product = products[key];
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.innerHTML = `
                    <img src="${product.image}" alt="${product.name}.jpg">
                    <h2>${product.name}</h2>
                    <p class="price">‚Çπ${product.price}</p>
                    <div class="stars">${getStars(product.stars)}</div>
                    <button class="share-btn">
                        ${sharedProducts[key] ? 
                            '<i class="fa-solid fa-check-circle"></i>&nbsp;Shared' : 
                            '<i class="fa-solid fa-share-nodes"></i>&nbsp;Share'}
                    </button>
                `;
    
                // If shared, disable the button
                if (sharedProducts[key]) {
                    const shareButton = productItem.querySelector('.share-btn');
                    shareButton.disabled = true; // Keep the button disabled
                }
    
              
    
                // Add event listener for WhatsApp share button
                const shareButton = productItem.querySelector('.share-btn');
                shareButton.onclick = (event) => {
                    event.stopPropagation(); // Prevent triggering the product link
                    shareOnWhatsApp(product);
    
                    // Replace the button content with a success symbol
                    shareButton.innerHTML = '<i class="fa-solid fa-check-circle"></i>&nbsp;Shared';
                    shareButton.disabled = true; // Optionally disable the button to prevent multiple clicks
    
                    // Store the state in local storage to remember it for the logged-in user
                    localStorage.setItem(`shareButtonState-${key}`, 'shared');
                };
    
                productList.appendChild(productItem);
            }
        }
    }
    


   function shareOnWhatsApp(product) {
    const starsString = getStarsString(product.stars);

    const message = `
Check out this product: ${product.name}

üéâ Explore the incredible features of this product at a **low price**! 
It‚Äôs designed with you in mind and will elevate your daily routine. 
Don't miss out on the chance to enhance your experience! üõçÔ∏è

Price: ‚Çπ${product.price}
Link: ${product.link}
Rating: ${starsString}

üåü Grab yours today and enjoy all the benefits! üåà
    `;

    // Encode the message for WhatsApp URL
    const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(message.trim())}`;
    window.open(url, '_blank');
}



function getStarsString(rating) {
    const fullStars = Math.floor(rating);
    const halfStar = rating % 1 !== 0;
    let starsString = '';

    // Add full stars
    for (let i = 0; i < fullStars; i++) {
        starsString += '‚≠ê'; // Full star emoji
    }

    // Add half star if exists
    if (halfStar) {
        starsString += '‚≠ê¬Ω'; // Half star emoji
    }

    // Add empty stars
    for (let i = fullStars + (halfStar ? 1 : 0); i < 5; i++) {
        starsString += '‚òÜ'; // Empty star emoji
    }

    return starsString;
}
    // Generate star rating HTML
    function getStars(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 !== 0;
        let starsHTML = '';

        for (let i = 0; i < fullStars; i++) {
            starsHTML += '<i class="fas fa-star"></i>';
        }

        if (halfStar) {
            starsHTML += '<i class="fas fa-star-half-alt"></i>';
        }

        for (let i = fullStars + (halfStar ? 1 : 0); i < 5; i++) {
            starsHTML += '<i class="far fa-star"></i>';
        }

        return starsHTML;
    }

    // Show shimmer effect while loading
    function showShimmerEffect() {
        const productList = document.querySelector('.product-list');
        productList.innerHTML = ''; // Clear existing products
        for (let i = 0; i < 12; i++) {
            const shimmerWrapper = document.createElement('div');
            shimmerWrapper.className = 'shimmer-wrapper';
            shimmerWrapper.innerHTML = `
                <div class="shimmer" style="width: 100%; height: 150px;"></div>
                <div class="shimmer" style="width: 80%; height: 20px; margin: 10px 0;"></div>
                <div class="shimmer" style="width: 60%; height: 20px;"></div>
            `;
            productList.appendChild(shimmerWrapper);
        }
    }

    // Filter products based on search input
    function filterProducts() {
        const searchTerm = document.querySelector('.search-container input').value.toLowerCase();
        const filteredProducts = bfsSearch(productsData, searchTerm);
        displayProducts(filteredProducts);
    }

    // BFS search implementation
    function bfsSearch(products, searchTerm) {
        if (!products) return [];
        let result = [];
        let queue = Object.values(products);

        while (queue.length) {
            let current = queue.shift();
            if (current.name.toLowerCase().includes(searchTerm)) {
                result.push(current);
            }
        }
        return result;
    }

   
    window.onload = function() {
        showShimmerEffect();
        document.querySelector('.search-container input').addEventListener('input', filterProducts);
    }

   
    
        document.getElementById('logout-button').addEventListener('click', () => {
            // Clear user data from Local Storage
            localStorage.removeItem('user');

            // Redirect to the login page
            window.location.href = '../'; // Adjust to your login page URL
        });



        // Get modal element
const modal = document.getElementById("welcomeModal");

// Get open modal button
const openModalButton = document.getElementById("openModal");

// Get close button
const closeModalButton = document.getElementById("closeModal");

// Listen for open click
openModalButton.addEventListener("click", function(e) {
e.preventDefault(); // Prevent default anchor behavior
modal.style.display = "block"; // Show the modal
});

// Listen for close click
closeModalButton.addEventListener("click", function() {
modal.style.display = "none"; // Hide the modal
});

// Listen for outside click to close modal
window.addEventListener("click", function(event) {
if (event.target === modal) {
    modal.style.display = "none"; // Hide the modal if clicked outside
}
});
    function displayUserName() {
        const savedUser = localStorage.getItem('user');
        if (savedUser) {
            const user = JSON.parse(savedUser);
            const welcomeMessage = document.getElementById('welcome-message');
            const userName = welcomeMessage.querySelector('.user-name');
            userName.innerHTML = user.displayName; // Display the user's name
        } else {
            console.log('No user is logged in.');
            // You can also redirect to the login page if no user is found
            window.location.href = '../login/';
        }
    }
    
    // Call the function when the page loads
    window.onload = displayUserName;
    
</script>

</head>
<body>
  

    <div class="header">
        <div class="logo"><i class="fa-solid fa-tag"></i></div>
        <div class="search-container">
            <input type="text" placeholder="Search products...">
        <button class="button" id="logout-button"><i class="fa-solid fa-right-from-bracket"></i></button>

        </div>
    </div><br>
    <div id="welcome-message">
        <span class="welcome-text">Welcome, </span>
        <span class="user-name"></span>
    </div>
    <div class="sub-header">Share budget-friendly product deals and earn!</div>
    

   
    <div class="main-content">
        <h3>Our Products</h3>   
        <div class="product-list"></div>
    </div>

    <!-- Floating Button -->
<!-- Floating Button -->
<button href="#" class="float-button" id="openModal">
    <i class="fas fa-plus"></i> <!-- Icon for the button -->
</button>

<!-- Modal Structure -->
<div id="welcomeModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeModal">&times;</span>
        <h1>Welcome!</h1>
        <p>Welcome to our site! We hope you enjoy your experience.</p>
    </div>
</div>


    <div class="modal" id="networkModal">
        <div class="modal-content">
            <p>Network disconnected. Please check your connection.</p>
            <button class="close-btn" onclick="closeModal()">Close</button>
            <button class="close-btn" onclick="refreshPage()">Refresh</button>
        </div>
    </div>
    
    <div class="toast" id="networkToast">
        <p>Network is slow. Please be patient.</p>
        <button class="close-btn" onclick="closeToast()">Close</button>
    </div>
</body>
</html>
