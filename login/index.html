<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Login Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script type="module">
        // Your web app's Firebase configuration
        const firebaseConfig = {
            projectId: "dropshipping-98eb5",
            apiKey: "AIzaSyC3WxZBaNJoZA2p7oe6ihTJCFOE6Y0U_7Q",
            authDomain: "dropshipping-98eb5.firebaseapp.com",
            databaseURL: "https://dropshipping-98eb5-default-rtdb.firebaseio.com",
            storageBucket: "dropshipping-98eb5.appspot.com",
            messagingSenderId: "904925867242",
            appId: "1:904925867242:android:4f6a2b1619f00100f8fb93"
        };

        // Import Firebase libraries
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app); // Initialize Realtime Database

        // Function to check if user UID already exists
        const checkUserExists = async (uid) => {
            const userRef = ref(database, 'users/' + uid);
            const snapshot = await get(userRef);
            return snapshot.exists(); // Returns true if the UID exists
        };

        // Google Login
        document.getElementById('google-login').addEventListener('click', () => {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider).then(async (result) => {
                const user = result.user;
                const uid = user.uid; // Get the UID

                // Check if user already exists in the database
                const userExists = await checkUserExists(uid);
                if (!userExists) {
                    // Store UID in Realtime Database if it does not exist
                    await set(ref(database, 'users/' + uid), {
                        uid: uid,
                        email: user.email,
                        displayName: user.displayName,
                    });
                    console.log('User UID saved to database');
                } else {
                    console.log('User UID already exists in the database');
                }

                // Redirect to main page
                window.location.href = '../home/index'; 
            }).catch((error) => {
                console.error('Error during login:', error);
            });
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css?family=Catamaran:800|Montserrat|Open+Sans:400,800&display=swap');

        body {
            background-color: #f6c8fe;
        }

        .bg {
            background-color: #e361f7;
        }

        h2 {
            color: #fff;
        }

        .bt {
            background-color: #fff;
            color: #bf0db2;
            font-weight: 1000;
            font-size: 18px;
        }

        i {
            font-weight: 1000;
            font-size: 18px;
        }

        img{
            border-radius: 30px;
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center min-h-screen ">
    <div class="w-full max-w-md p-8 space-y-6 rounded-lg shadow-md bg">
        <h2 class="text-2xl font-bold text-center ">Login to Share</h2>

        <img src="bb.jpg" alt="">
        <div>
            <button id="google-login" class="w-full px-4 py-2 text-white bg-blue-600 rounded-md bt">Login with <i class="fab fa-google"></i></button>
        </div>
    </div>
</body>

</html>
